---
title: 后端开发面试知识点之mysql
tags:
  - 后端开发
  - 面试
  - 数据库
  - mysql
categories:
  - 后端开发
author: 艾逗笔
date: 2018-11-05 00:00:00
---


## 事务特性（ACID)

- 原子性：不可分割的操作单元，事务中所有操作，要么全部成功；要么撤回到执行事务之前的状态
- 一致性：如果在执行事务之前数据库是一致的，那么在执行事务之后数据库也还是一致的；
- 隔离性：事务操作之间彼此独立和透明互不影响。事务独立运行。这通常使用锁来实现。一个事务处理后的结果，影响了其他事务，那么其他事务会撤回。事务的100%隔离，需要牺牲速度。
- 持久性：事务一旦提交，其结果就是永久的。即便发生系统故障，也能恢复。
<!-- more -->

## 事务特性（ACID)

- 原子性：不可分割的操作单元，事务中所有操作，要么全部成功；要么撤回到执行事务之前的状态
- 一致性：如果在执行事务之前数据库是一致的，那么在执行事务之后数据库也还是一致的；
- 隔离性：事务操作之间彼此独立和透明互不影响。事务独立运行。这通常使用锁来实现。一个事务处理后的结果，影响了其他事务，那么其他事务会撤回。事务的100%隔离，需要牺牲速度。
- 持久性：事务一旦提交，其结果就是永久的。即便发生系统故障，也能恢复。

## 事务的隔离级别

- read uncommited：使用查询语句不会加锁，可能会读到未提交的行（脏读）
- read commited：多次使用查询语句，可能得到不同的结果（不可重复读）
- repeatable read：多次读取会返回第一次读取的数据快照（幻读）
- serializable：innodb隐式的将全部查询语句加上共享锁（串行化）

## 脏读、幻读、不可重复读

- 脏读：读取到了未提交的数据，事务回滚后导致两次读取不一样，第一次读取的为脏数据
- 不可重复读：读取过程中修改了数据，事务提交之后导致第二次读到的数据和第一次读到的不一样
- 幻读：读取过程中插入或删除了新的记录，导致第二次读到的数据多了或少了一行，就像是出现了幻觉

mysql默认使用repeatable read隔离级别。事务级别越严格，并发性能越低



## mysql日志

- 回滚日志
- 重做日志
- 事务日志

## 数据表结构

- 表空间
- 段
- 区
- 页
- 行

## 索引原理

- 索引是一种数据结构，能够加快数据查询速度
- 索引的缺点是会有额外的开销
- mysql普遍使用B+Tree做索引

## B+Tree、B-Tree

## 聚集索引与非聚集索引

- 聚集索引的表记录顺序与索引的顺序一直；非聚集索引指定了表中数据的逻辑顺序，但记录的物理顺序与索引的顺序不同
- 聚集索引的叶节点就是数据节点；非聚集索引的叶节点还是索引节点，有一个指针指向数据节点
- 每个表中最多只能有一个聚集索引
- 表的主键默认为聚集索引
- 聚集索引会降低insert和update的操作性能
- 适合用聚集索引：列包含有限数目的不同值、查询结果返回一个区间的值、查询结果返回某值相同的大量结果集；适合用非聚集索引：列包含大量数目不同的值、查询结果返回少量结果集、order by子语句使用了列

## 最左匹配原则

## 建索引的原则

- 最左匹配原则。创建多列索引时，where子句中使用最频繁的字段放到最左边
- 尽量选择数据区分度高的列建索引
- 索引列不能参与计算
- 尽量扩展索引，不要新增索引

## sql优化

- where条件尽量避免使用!=和<>
- where条件尽量不要使用or进行查询
- 数据字段设置默认值，where条件尽量避免使用is null
- 避免使用select *
- order by走索引优化
- 使用exists代替in
- 使用varchar代替char
- 能用distinct就不用order by
- 能用union all就不用union（union会执行select distinct）
- 尽量避免join，如果用了join，尽量使用建立过索引的相同类型的字段进行连接

## myisam与innodb的区别

- 存储结构。myisam在磁盘存储.frm .MYD .MYI三个文件，数据和索引分开存储；innodb数据和索引保存在同一个表空间
- 存储空间。myisam可被压缩，存储空间小，支持静态表、动态表、压缩表三种存储格式；innodb需要更多的内存和存储，会在主内存中建立缓冲区用来缓冲数据和索引
- 索引和记录存储。myisam索引和行记录是分开存储的，使用非聚集索引；innodb主键索引与行记录是存储在一起的，数据文件本身就是主索引，使用聚集索引
- 事务支持。innodb支持事务，myisam不支持
- auto_increment。myisam可以和其他字段一起建立联合索引，自动增长列必须是索引，联合索引中可以不是第一列；innodb必须包含只有该字段的索引，自动增长列必须是索引，联合索引中必须是第一列
- 锁差异。myisam只支持表锁，innodb支持表锁和行锁，行锁必须在where查询中使用主键
- 全文索引。myisam支持全文索引，innodb不支持全文索引
- 表主键。myisam可以没有任何的索引和主键；innodb如果没有设置主键或者非空唯一索引，就会自动创建6字节的主键
- 表行数。myisam保存表的总行数，select count()更快；innodb没有保存表行数，select count()需要扫描全表，加了where条件的情况下两者效果一致
- 外键。innodb支持外键，myisam不支持外键
- curd。如果大量的select操作，选择myisam。如果大量的更新操作，选择innodb

